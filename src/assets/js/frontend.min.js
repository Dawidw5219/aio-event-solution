jQuery(document).ready(m=>{m("#aio-event-registration-form").on("submit",function(e){e.preventDefault();let t=m(this),a=t.find('button[type="submit"]'),o=a.find(".aio-btn-text"),n=a.find(".aio-btn-loader"),s=m(".aio-registration-messages");s.empty();e=t.serialize()+"&action=aio_register_event";a.prop("disabled",!0),o.hide(),n.show(),m.ajax({url:aioEvents.ajaxUrl,type:"POST",data:e,success:e=>{e.success?(s.html('<div class="aio-message aio-message-success">'+e.data.message+"</div>"),t[0].reset(),m("html, body").animate({scrollTop:s.offset().top-100},500)):s.html('<div class="aio-message aio-message-error">'+e.data.message+"</div>")},error:()=>{s.html('<div class="aio-message aio-message-error">'+aioEvents.i18n.error+": An unexpected error occurred. Please try again.</div>")},complete:()=>{a.prop("disabled",!1),o.show(),n.hide()}})}),m(".event-card").on("mouseenter",function(){m(this).addClass("scale-105")}).on("mouseleave",function(){m(this).removeClass("scale-105")}),m('a[href^="#"]').on("click",function(e){var t=m(this.getAttribute("href"));t.length&&(e.preventDefault(),m("html, body").stop().animate({scrollTop:t.offset().top-100},800))}),m(".aio-event-rsvp-button").on("click",function(e){e.preventDefault();let t=m(this);e=t.data("event-id");m.ajax({url:aioEvents.ajaxUrl,type:"POST",data:{action:"aio_event_rsvp",nonce:aioEvents.nonce,event_id:e},beforeSend:()=>{t.prop("disabled",!0).text("Zapisywanie...")},success:e=>{e.success&&(t.text("Zapisano!").addClass("bg-green-500"),setTimeout(()=>{t.prop("disabled",!1).text("RSVP").removeClass("bg-green-500")},2e3))},error:()=>{t.prop("disabled",!1).text("Błąd - spróbuj ponownie")}})});{let t=setInterval(()=>{let v=document.querySelector("#sib-form");if(v){clearInterval(t),(e=>{let t=e.querySelector('input[name="COUNTRY"], input[id="COUNTRY"]');t?(console.log("[AIO Events] Country field found, detecting country..."),(e=(navigator.language||navigator.userLanguage).split("-")[1]?.toUpperCase())&&2===e.length?(t.value=e,console.log("[AIO Events] Country detected from browser language:",e)):(console.log("[AIO Events] Browser language detection failed, trying IP geolocation..."),fetch("https://ipapi.co/json/").then(e=>e.json()).then(e=>{e.country_code&&2===e.country_code.length?(t.value=e.country_code.toUpperCase(),console.log("[AIO Events] Country detected from ipapi.co:",e.country_code.toUpperCase())):console.log("[AIO Events] ipapi.co did not return valid country code")}).catch(()=>{console.log("[AIO Events] ipapi.co failed, trying alternative API..."),fetch("https://ip-api.com/json/?fields=countryCode").then(e=>e.json()).then(e=>{e.countryCode&&2===e.countryCode.length?(t.value=e.countryCode.toUpperCase(),console.log("[AIO Events] Country detected from ip-api.com:",e.countryCode.toUpperCase())):console.log("[AIO Events] ip-api.com did not return valid country code")}).catch(()=>{console.log("[AIO Events] All country detection methods failed")})}))):console.log("[AIO Events] Country field not found in form")})(v),(e=(e=v).querySelector('input[name="COUNTRY"], input[id="COUNTRY"]'))&&(e=e.closest(".sib-form-block"))&&e.parentElement&&(e.parentElement.style.display="none",console.log("[AIO Events] Country field container hidden"));let p=v.closest("#aio-events-brevo-form-wrapper"),u=p?p.dataset.eventId:null;if(u){let d=aioEvents.restUrl+"register";v.addEventListener("submit",function(e){e.preventDefault();var e=m(this),t=m(p);let a=t.find(".aio-events-brevo-form-container"),o=t.find(".aio-events-registration-success"),n=t.find(".aio-events-registration-error"),s=(n.hide(),e.find('button[type="submit"], input[type="submit"]')),r=s.is("input")?s.val():s.html();s.prop("disabled",!0);var t='<span class="aio-spinner" style="display:inline-block;width:16px;height:16px;border:2px solid rgba(255,255,255,0.3);border-top-color:#fff;border-radius:50%;animation:aio-spin 0.8s linear infinite;vertical-align:middle;"></span>',i=(document.getElementById("aio-spinner-style")||m("head").append('<style id="aio-spinner-style">@keyframes aio-spin{to{transform:rotate(360deg)}}</style>'),s.is("input")?(s.css("color","transparent").after('<span class="aio-btn-spinner" style="position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);">'+t+"</span>"),s.parent().css("position","relative")):s.data("original-html",r).html(t),{}),l=v.elements;for(let e=0;e<l.length;e++){var c=l[e];c.name&&"email_address_check"!==c.name&&("checkbox"!==c.type&&"radio"!==c.type||c.checked)&&(i[c.name]=c.value)}m.ajax({url:d+"?event_id="+u,type:"POST",contentType:"application/json",data:JSON.stringify({event_id:parseInt(u),form_data:i}),success:e=>{e.success||!1!==e.brevo_success?(a.slideUp(300,function(){m(this).hide()}),e.email?o.find(".aio-events-success-email-value").text(e.email):o.find(".aio-events-success-email").hide(),o.slideDown(300),m("html, body").animate({scrollTop:o.offset().top-100},500)):(e=e.message||"Registration failed",n.find(".aio-events-error-message-text").text(e),n.slideDown(300),s.prop("disabled",!1),m(".aio-btn-spinner").remove(),s.is("input")?s.css("color","").val(r):s.html(r))},error:e=>{e=e.responseJSON?.message||"Registration failed";n.find(".aio-events-error-message-text").text(e),n.slideDown(300),s.prop("disabled",!1),m(".aio-btn-spinner").remove(),s.is("input")?s.css("color","").val(r):s.html(r)}})}),v.setAttribute("action",d+"?event_id="+u),new MutationObserver(e=>{e.forEach(e=>{"attributes"===e.type&&e.target===v&&"action"===e.attributeName&&v.getAttribute("action")!==d+"?event_id="+u&&v.setAttribute("action",d+"?event_id="+u)})}).observe(v,{attributes:!0,attributeFilter:["action"]})}else console.error("AIO Events: Event ID not found in wrapper")}var e},100);setTimeout(()=>{clearInterval(t)},1e4)}let a=()=>{var e=document.querySelector(".aio-events-registration-success");if(e){let o=e.dataset.eventTitle||"";var t=e.dataset.eventSubtitle||"";let n=e.dataset.utcStart||"",s=e.dataset.utcEnd||"";var r=e.dataset.calendarNotice||"The event link will be sent to your registered email shortly before the event starts.";if(n&&s){var i=[];t&&i.push(t),i.push(r);let a=i.join("\n\n");var t=e.querySelector(".aio-calendar-google"),i=(t&&((r=new URL("https://calendar.google.com/calendar/render")).searchParams.set("action","TEMPLATE"),r.searchParams.set("text",o),r.searchParams.set("dates",n+"/"+s),r.searchParams.set("details",a),t.href=r.toString(),t.target="_blank",t.rel="noopener noreferrer"),e.querySelector(".aio-calendar-outlook")),r=(i&&(r=e=>{var t=e.match(/(\d{4})(\d{2})(\d{2})T(\d{2})(\d{2})(\d{2})Z/);return t?`${t[1]}-${t[2]}-${t[3]}T${t[4]}:${t[5]}:${t[6]}Z`:e},(t=new URL("https://outlook.live.com/calendar/0/action/compose")).searchParams.set("subject",o),t.searchParams.set("startdt",r(n)),t.searchParams.set("enddt",r(s)),t.searchParams.set("body",a),i.href=t.toString(),i.target="_blank",i.rel="noopener noreferrer"),e.querySelector(".aio-calendar-ics"));r&&!r.dataset.initialized&&(r.dataset.initialized="true",r.addEventListener("click",e=>{e.preventDefault();var e=["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//AIO Events//Event Registration//EN","CALSCALE:GREGORIAN","METHOD:PUBLISH","BEGIN:VEVENT","DTSTART:"+n,"DTEND:"+s,"SUMMARY:"+o.replace(/,/g,"\\,"),"DESCRIPTION:"+a.replace(/\n/g,"\\n").replace(/,/g,"\\,"),"STATUS:CONFIRMED","UID:"+Date.now()+"@aio-events","END:VEVENT","END:VCALENDAR"].join("\r\n"),e=new Blob([e],{type:"text/calendar;charset=utf-8"}),e=URL.createObjectURL(e),t=document.createElement("a");t.href=e,t.download=o.replace(/[^a-z0-9]/gi,"-").toLowerCase()+".ics",document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(e)}))}}};document.querySelectorAll(".aio-events-registration-success").forEach(t=>{"none"!==t.style.display&&a(),new MutationObserver(e=>{e.forEach(e=>{"attributes"===e.type&&"style"===e.attributeName&&"none"!==t.style.display&&a()})}).observe(t,{attributes:!0,attributeFilter:["style"]})})});